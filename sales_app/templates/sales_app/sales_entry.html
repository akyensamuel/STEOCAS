{% extends "core/base.html" %}
{% load widget_tweaks %}
{% block content %}
<div class="max-w-3xl mx-auto mt-8 p-6 bg-white dark:bg-gray-800 rounded-lg shadow">
    <h2 class="text-2xl font-bold mb-6 text-gray-900 dark:text-gray-100">Enter Sale</h2>
    <form method="post" id="sales-form">
        {% csrf_token %}
        <div class="space-y-6 mb-6">
            {{ form.non_field_errors }}
            <div class="mb-4">
                <label class="block mb-2 text-sm font-semibold text-gray-900 dark:text-white">Recorded by</label>
                <input type="text" value="{{ request.user.username }}" readonly class="w-full rounded-lg border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-2 cursor-not-allowed" />
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {% for field in form.visible_fields %}
                    {% if field.name != 'product' %}
                    <div>
                        <label for="{{ field.id_for_label }}" class="block mb-2 text-sm font-semibold text-gray-900 dark:text-white">{{ field.label }}</label>
                        {{ field.errors }}
                        <div>
                            {{ field|add_class:'w-full rounded-lg border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 px-3 py-2' }}
                        </div>
                        {% if field.help_text %}
                            <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">{{ field.help_text }}</p>
                        {% endif %}
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        <div class="flex flex-col sm:flex-row gap-4">
            <button type="submit" name="save_print" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Save and Print</button>
            <button type="submit" name="save" class="text-white bg-green-700 hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800">Save</button>
        </div>
    </form>
</div>
<script>
    // Set auto date and time
    document.addEventListener('DOMContentLoaded', function() {
        const dt = new Date();
        const datetimeInput = document.getElementById('datetime');
        if (datetimeInput) {
            datetimeInput.value = dt.toLocaleString();
        }

        function updateTotals() {
            const unitPriceInput = document.getElementById('id_unit_price');
            const quantityInput = document.getElementById('id_quantity');
            const amountPaidInput = document.getElementById('id_amount_paid');
            const totalPriceInput = document.getElementById('id_total_price');
            const balanceInput = document.getElementById('id_balance');
            if (unitPriceInput && quantityInput && amountPaidInput && totalPriceInput && balanceInput) {
                const unitPrice = parseFloat(unitPriceInput.value) || 0;
                const quantity = parseFloat(quantityInput.value) || 0;
                const amountPaid = parseFloat(amountPaidInput.value) || 0;
                const totalPrice = unitPrice * quantity;
                totalPriceInput.value = totalPrice.toFixed(2);
                balanceInput.value = (totalPrice - amountPaid).toFixed(2);
            }
        }

        const unitPriceInput = document.getElementById('id_unit_price');
        const quantityInput = document.getElementById('id_quantity');
        const amountPaidInput = document.getElementById('id_amount_paid');
        if (unitPriceInput) unitPriceInput.addEventListener('input', updateTotals);
        if (quantityInput) quantityInput.addEventListener('input', updateTotals);
        if (amountPaidInput) amountPaidInput.addEventListener('input', updateTotals);
        // Trigger calculation on page load
        updateTotals();
    });
</script>
{% endblock %}